### **PRD: “浮光译影” \- 实时字幕翻译工具** 

### **1\. 项目概述 (Project Overview)**

开发一款名为“浮光译影”的桌面应用程序。其核心功能是实时捕捉系统播放的音频，通过**阿里云百炼的端到端语音翻译模型**，直接将音频流翻译成中文。

应用提供两种窗口模式：

1. 一个可定制的、置顶的**浮窗**，用于实时显示当前句子的翻译字幕。  
2. 一个标准的**历史记录窗口**，用于展示本次运行以来的所有翻译结果。

**核心解决的用户痛点**: 为观看外语视频的用户提供一个极简、低延迟的实时翻译字幕，并提供完整的翻译历史记录，方便回顾和学习。

#### **2\. 核心技术栈 (Core Technology Stack)**

* **编程语言**: Python 3.9+  
* **图形界面 (GUI)**: PyQt6  
* **语音翻译 (Speech-to-Text Translation)**: **阿里云百炼语音翻译模型**  
* **系统音频捕获**: soundcard 库 (用于跨平台捕获)

#### **3\. 技术方案选择 (Technology Approach Selection)**

本项目选用**端到端语音翻译模型**。

* **流程**: 直接通过百炼语音翻译模型，将音频流一步转换为目标语言（中文）的文本。  
* **选用理由**:  
  * **架构简洁**: 只需调用单个AI服务，降低了代码集成的复杂性。  
  * **潜在的低延迟**: 端到端模型减少了中间环节，理论上可以实现更低的整体延迟。  
* **已知权衡 (Trade-off)**:  
  * 此方案直接输出译文，**无法获取中间识别出的原文**。因此，本应用将只显示翻译后的字幕，不提供双语对照功能。

#### **4\. 功能需求 (Functional Requirements)**

**FR-01: 系统音频捕获模块**

* 必须能够捕获操作系统的“立体声混音”或“扬声器输出”，而非麦克风输入。  
* 音频捕获应在独立的后台线程中运行，以避免阻塞主 GUI 线程。  
* 捕获的音频数据需转换为百炼模型服务所需的格式（如：16000Hz 采样率, 16-bit, 单声道 PCM）。

**FR-02: 实时语音翻译模块**

* 使用相应的阿里云 SDK 与百炼语音翻译服务建立实时连接。  
* 将从 FR-01 捕获的音频流持续发送到服务。  
* 当收到一句完整的、确定的翻译结果时，将其同时传递给**浮窗模块**和**历史记录模块**。

**FR-03: 字幕浮窗 GUI 模块 (主窗口)**

* **窗口属性**:  
  * 无边框窗口 (Frameless)。  
  * 始终保持在所有窗口最顶层 (Always on Top)。  
  * 窗口背景半透明，透明度可调。  
  * 用户可以通过鼠标拖动窗口位置。  
* **字幕显示**:  
  * **只显示当前最新的中文翻译文本**。  
  * 字幕文本应能根据窗口大小自动换行。  
  * 新字幕出现时，旧字幕被替换。  
* **用户交互 (通过右键菜单实现)**:  
  * **显示/隐藏历史记录**: 控制历史记录窗口的可见性。  
  * **设置**: 打开设置窗口。  
  * **暂停/继续**: 控制服务的开启和关闭。  
  * **退出**: 关闭应用。

**FR-04: 设置模块**

* 提供一个简单的设置界面或通过配置文件 (config.ini) 实现。  
* **安全配置**: 用户必须在此处填写阿里云的 AccessKey ID 和 AccessKey Secret。**严禁将密钥硬编码在代码中**。  
* **字幕设置**:  
  * 调整字幕字体大小、颜色。  
  * 调整浮窗背景透明度（滑块）。

**FR-05: 历史记录窗口模块 (新增)**

* **窗口属性**:  
  * 一个标准的、带标题栏的窗口（非置顶）。  
  * 窗口大小可调整，内容可滚动。  
* **内容显示**:  
  * 使用一个只读的文本区域来显示内容。  
  * 每当接收到新的翻译结果时，**在末尾追加新的一行**。  
  * 用户可以自由滚动、选择和复制历史记录中的文本。

#### **5\. 开发步骤建议 (Prompts for AI Assistant)**

**第一阶段：环境与基础界面**

1. “请为我创建一个 Python 项目，使用 PyQt6。先生成一个 requirements.txt 文件，包含 PyQt6, soundcard 以及调用阿里云百炼模型所需的SDK。”  
2. “使用 PyQt6 创建一个**浮窗**，要求：无边框、背景半透明、始终置顶，可用鼠标拖动。窗口中放置一个 QLabel 用于显示实时字幕。”  
3. “再创建一个**标准的 PyQt6 窗口**作为历史记录窗口。它应该包含一个可滚动的 QTextEdit 控件，并设置为只读。”

第二阶段：集成核心服务  
4\. “现在，编写一个独立的 Python 脚本，演示如何使用阿里云百炼语音翻译模型的 Python SDK。这个脚本应该从麦克风读取音频，并将实时翻译出的中文结果打印到控制台。请在代码中留出填写 AccessKey 的位置。”  
第三阶段：功能整合  
5\. “将百炼的实时翻译功能整合到 PyQt6 应用中。要求：点击一个‘开始’按钮后，在后台线程中启动麦克风音频捕获和翻译。每当收到新的翻译结果时，同时执行两个操作：1. 更新浮窗 QLabel 的文本；2. 在历史记录窗口的 QTextEdit 中追加一行新文本。请使用 PyQt 的信号与槽机制处理好线程安全问题。”  
第四阶段：完善与优化  
6\. “现在，将音频输入源从麦克风改为系统扬声器输出。请使用 soundcard 库来实现。”  
7\. “为浮窗添加一个右键菜单，可以切换历史记录窗口的显示和隐藏。”  
8\. “创建一个 config.ini 配置文件来管理阿里云的密钥和用户设置（如字体大小、透明度），并实现一个简单的设置窗口来修改这些配置。”

#### **6\. 关键参考文档 (Key Reference Documents)**

* **阿里云百炼语音翻译模型**:  
  * [https://bailian.console.aliyun.com/?tab=doc\#/doc/?type=model\&url=2983281](https://bailian.console.aliyun.com/?tab=doc#/doc/?type=model&url=2983281)  
* **PyQt6 官方文档/教程**:  
  * [https://www.pythonguis.com/pyqt6-tutorial/](https://www.pythonguis.com/pyqt6-tutorial/)  
* **SoundCard 库 (用于系统音频捕获)**:  
  * [https://github.com/bastibe/SoundCard](https://github.com/bastibe/SoundCard)